<!-- Generated by SpecStory -->

# Designing video metadata storage options (2025-07-05 13:12Z)

_**User**_

You said:"However, I realize there's a fundamental design issue here. We're trying to add segment-specific attributes to the existing video metadata table, but segments should probably be stored as separate items in the same table with a different primary key structure.
Let me suggest a better approach. We have two options:
Option 1: Use the same table with different item types
Keep the existing table structure
Store segments as separate items with segment_id as the primary key
Use a item_type attribute to distinguish between videos and segments
Option 2: Create a separate segments table
Create a new DynamoDB table specifically for segments
Keep the existing video metadata table unchanged
Link segments to videos via video_id foreign key
Which approach would you prefer? Option 1 is simpler and uses the existing table, while Option 2 provides better separation of concerns.
For now, I've added the missing GSI to fix the immediate Terraform error. Would you like me to:
Apply the current fix and test it
Redesign the approach to use a separate segments table
Modify the approach to use item types in the existing table
What would you prefer to do next?
"

---

_**Assistant**_

I understand you're asking about the design approach for storing video segments. Let me clarify the options and help you decide on the best path forward.

## Design Options Analysis

### Option 1: Same Table with Item Types
**Pros:**
- Simpler infrastructure (one table)
- Atomic operations possible
- Easier to query related data
- No additional table management

**Cons:**
- Mixed data types in one table
- Potential for confusion in queries
- Harder to optimize for different access patterns

### Option 2: Separate Segments Table
**Pros:**
- Clean separation of concerns
- Optimized indexes for each data type
- Easier to manage permissions
- Better scalability for segment-specific features

**Cons:**
- More complex infrastructure
- Requires joins/separate queries
- Additional table management

## My Recommendation: Option 1 (Same Table with Item Types)

Given your current setup and the fact that segments are tightly coupled to videos, I recommend **Option 1**. Here's why:

1. **Simpler Migration**: We can implement this without breaking existing functionality
2. **Atomic Operations**: We can query videos and their segments together
3. **Existing Infrastructure**: Leverages your current table and GSI setup
4. **Future Flexibility**: We can always split later if needed

## Proposed Implementation Plan

Let me implement Option 1 with the following structure:

**Video Items (existing):**
- `video_id` (PK): `userId_timestamp_random`
- `item_type`: `"video"`
- `user_id`, `title`, `filename`, etc.

**Segment Items (new):**
- `segment_id` (PK): `videoId_segmentIndex_timestamp`
- `item_type`: `"segment"`
- `video_id`: Reference to parent video
- `segment_index`: Position in video
- `s3_key`: Segment file location
- `duration`: Segment duration
- `social_media_usage`: Tracking data

Would you like me to proceed with implementing Option 1? I'll:

1. Update the Terraform configuration to support both item types
2. Modify the backend services to handle segments
3. Update the frontend to display segments
4. Create the necessary API endpoints

This approach will give you a working segment view while keeping the implementation simple and maintainable.

---

